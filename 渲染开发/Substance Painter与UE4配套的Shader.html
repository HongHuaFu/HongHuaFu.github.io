<html>
<head>
  <title>Substance Painter与UE4配套Shader</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602263 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="699"/>

<div>
  <style>
    body, td {
      margin-right: 40%;
      margin-left:10%;
      margin-top: 50px;
    }
  </style>
<span><div><div><span style="font-size: 24pt;">Substance Painter与UE4配套的Shader</span></div><div><font style="font-size: 24pt;"><br/></font></div><div><span style="font-size: 8pt;">2020/09/26</span></div><div><span style="font-size: 8pt;">qiutang</span></div><div><font style="font-size: 8pt;"><br/></font></div><div>        要为UE4项目编写SP的Shader，首先得把MobileBasePassXXX.usf翻出来。然后将通用的直射光 漫反射+ 高光 + Skylight + IBL全拿出来，再和特殊材质如SSS、Aniso等材质编辑器中的Shader拿出来，组合一下，就完成了。</div><div>        参考了Substance Painter提供的示例Shader，还有涛哥给的他之前写的SP shader。很快就熟悉了SP的Shader编写方式。</div><div>        这里给个超简洁的 SP Shader示例：<a href="https://github.com/ianbanks/arma_3_substance_shader">https://github.com/ianbanks/arma_3_substance_shader</a></div><div>        </div><div>        然后经过长时间的摸索和涛哥指导，SP Shader注意项：</div><ol><li><div>IBL计算必须和UE4 中的一样。绝对不能使用Substance Painter提供pbrComputeSpecular，差距非常的大，SP这个函数用了多次重要性采样积分，效果好得不得了。UE4 Mobile 的IBL就根据Roughness采样Cubemap lod，然后简单平方乘上一个亮度值，非常的搓。</div></li><li><div>环境贴图使用LDR，UE4 Mobile的光照图就是LDR，HDR会相对过曝了，美术他们绘制时可能会因为HDR关系把BaseColor亮度级别拉得相对较暗，导入引擎时有差距。</div></li><li><div>必须写在同一个Shader中。我一开始直接写了个模板，然后python根据输入参数不同生成不同的shader文件，比如皮肤一个，头发一个，丝绸一个。这导致模型进SP时得分开材质，导出时贴图没办法合并在一起。虽然可以在Substance Designer中合并贴图，但是SP导出时必须将填充像素减少到 1- 2。否则合并时UV岛会相交。然后这也会导致另外一个问题，合并完后UV岛边界填充少，贴图Mipmap会有texture bleeding现象，也就是远处有道缝。必须在python里再扩充一次UV岛，虽然问题最后解决了，但这美术工序越来越复杂了，最终只好全部写在一个Shader中，让美术额外绘制材质遮罩好了。</div></li><li><div>ToneMapper部分也要加上去，直接写在Shader中就好了，因为调色影响很大，UE4的ToneMapper是他改过的Film函数，我直接Copy过来一个字都没改，当然需要注意改一下DX和Opengl矩阵的行列主序问题和矩阵乘法部分。</div></li></ol><div><br/></div></div><div><br/></div></span>
</div></body></html>